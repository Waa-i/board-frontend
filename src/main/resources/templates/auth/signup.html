<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>회원가입</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/assets/css/auth/signup.css}">
    <link rel="icon" href="/favicon.ico" sizes="any">
</head>

<body class="bg-body-tertiary">
<main class="container py-5 join-container">
    <div class="card shadow-sm join-card">
        <div class="card-body p-4 p-md-5">

            <h1 class="h3 fw-semibold mb-4">회원가입</h1>

            <form id="signupForm"
                  th:action="@{/signup}"
                  th:object="${form}"
                  method="post"
                  novalidate
                  data-otp-send-url="/signup/email-verifications"
                  data-otp-verify-url="/signup/email-verifications/verify">

                <!-- username -->
                <div class="mb-3">
                    <label class="form-label" for="username">아이디</label>
                    <input id="username"
                           type="text"
                           class="form-control"
                           th:field="*{username}"
                           autocomplete="username"
                           inputmode="latin"
                           required
                           data-required-msg="아이디를 입력해주세요."
                           data-size-msg="아이디는 5~20자입니다."
                           data-format-msg="아이디는 영문 소문자와 숫자만 가능하며 영문은 필수입니다."
                           data-min="5"
                           data-max="20"
                           data-regex="^(?=.*[a-z])[a-z0-9]+$"
                           data-check-url="/signup/availability?field=username&value={value}">
                    <div id="usernameFeedback" class="field-feedback"></div>
                </div>

                <!-- password -->
                <div class="mb-3">
                    <label class="form-label" for="password">비밀번호</label>

                    <div class="password-wrap">
                        <input id="password"
                               type="password"
                               class="form-control password-input"
                               th:field="*{password}"
                               autocomplete="new-password"
                               required
                               data-required-msg="비밀번호를 입력해주세요."
                               data-size-msg="비밀번호는 8~20자입니다."
                               data-format-msg="비밀번호는 영문, 숫자, 특수문자('!', '@', '#', '$', '%', '^', '&', '*', '(', ')')를 각각 1개 이상 포함해야 하며 공백은 사용할 수 없습니다."
                               data-min="8"
                               data-max="20"
                               data-regex="^(?=\S+$)(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()])[A-Za-z\d!@#$%^&*()]+$">

                        <button type="button"
                                id="togglePassword"
                                class="password-toggle"
                                aria-label="비밀번호 보기/숨기기">
                            <i id="togglePasswordIcon" class="bi bi-eye-slash" aria-hidden="true"></i>
                        </button>
                    </div>

                    <div id="passwordFeedback" class="field-feedback"></div>
                </div>

                <!-- email -->
                <div class="mb-2">
                    <label class="form-label" for="email">이메일</label>

                    <div class="input-group">
                        <input id="email"
                               type="email"
                               class="form-control"
                               th:field="*{email}"
                               autocomplete="email"
                               required
                               data-required-msg="이메일을 입력해주세요."
                               data-format-msg="이메일 형식이 올바르지 않습니다."
                               data-regex="^[^\s@]+@[^\s@]+\.[^\s@]+$"
                               data-check-url="/signup/availability?field=email&value={value}">

                        <button type="button"
                                id="emailVerifyBtn"
                                class="btn btn-outline-secondary"
                                disabled>
                            이메일 인증
                        </button>
                    </div>

                    <div id="emailFeedback" class="field-feedback"></div>
                </div>

                <!-- OTP -->
                <div class="mb-3 otp-section" id="otpSection">
                    <div class="input-group">
                        <input id="otp"
                               type="text"
                               class="form-control"
                               inputmode="numeric"
                               autocomplete="one-time-code"
                               placeholder="인증번호 6자리"
                               maxlength="6"
                               disabled>

                        <button type="button" id="otpVerifyBtn" class="btn btn-outline-primary" disabled>인증하기</button>
                        <button type="button" id="otpResendBtn" class="btn btn-outline-secondary" disabled>재전송</button>
                    </div>

                    <div class="otp-meta">
                        <div id="otpFeedback" class="field-feedback"></div>
                        <div class="otp-timers">
                            <small class="text-secondary">남은시간 <span id="otpTimer">05:00</span></small>
                            <small class="text-secondary"> · 재전송 <span id="resendTimer">01:00</span></small>
                        </div>
                    </div>
                </div>

                <!-- nickname -->
                <div class="mb-4">
                    <label class="form-label" for="nickname">닉네임</label>
                    <input id="nickname"
                           type="text"
                           class="form-control"
                           th:field="*{nickname}"
                           required
                           data-required-msg="닉네임을 입력해주세요."
                           data-size-msg="닉네임은 2~20자입니다."
                           data-format-msg="닉네임은 한글, 영문 소문자, 숫자만 사용할 수 있습니다."
                           data-min="2"
                           data-max="20"
                           data-regex="^[a-z0-9가-힣]+$"
                           data-check-url="/signup/availability?field=nickname&value={value}">
                    <div id="nicknameFeedback" class="field-feedback"></div>
                </div>

                <button class="btn btn-outline-primary w-100 join-submit" type="submit">
                    가입하기
                </button>
            </form>

        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
<script defer th:src="@{/assets/js/auth/signup.js}"></script>
</body>
</html>
